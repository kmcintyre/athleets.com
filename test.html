<html>
<head>
<meta charset="UTF-8">
</head>
<body>
<form>
<!--[if IE]>
   You're using IE!
<![endif]-->
<![if !IE]>
   You're using something else!
<![endif]>

<script>

<input type="text" name="city" list="cities">
</script>

<datalist id="cities"></datalist>
<select name="state" id="state"><option value="">-Select State-</select>
</form>
<script>
document.addEventListener("DOMContentLoaded", function(event) { 
  var r = new XMLHttpRequest(); 
  r.open("GET", "pt-BR.json", true);
  r.onreadystatechange = function () {
	if (r.readyState != 4 || r.status != 200) return;
	var json = JSON.parse(r.responseText)
	console.log(json.length) 
	
	
	
	json.forEach(function (state) {
		var state_opt = document.createElement('option');
		state_opt.setAttribute('value', state.state_abbr)
		state_opt.innerHTML = state.state_name;
		document.querySelector('[name="state"]').appendChild(state_opt);
	});	
	document.querySelector('[name="city"]').addEventListener('input', function (e) {
		document.getElementById('cities').innerHTML = ''
		var sv = document.querySelector('[name="state"]').options[document.querySelector('[name="state"]').selectedIndex].value
		json.filter(function (state) {
			return !sv || state.state_abbr == sv; 
		}).map(function (state) {
			var qc = state.cities.filter(function (city_obj) {
				return city_obj.city.toLowerCase().indexOf(document.querySelector('[name="city"]').value.toLowerCase()) == 0;
			})
			qc.forEach(function (city) { city.state_abbr = state.state_abbr });
			return qc
		}).forEach(function (state) {			
			Object.keys(state).forEach(function (c) {
				//console.log(state[c]);
				city_opt = document.createElement('option');
				city_opt.setAttribute('value', state[c].city)
				city_opt.innerHTML = '<span style="float:left">' + state[c].city + '</span><span style="float:right">' + state[c].state_abbr + '</span>';
				document.getElementById('cities').appendChild(city_opt) 
			}); 
		});		
	});
  };
  r.send();
});
</script>
</body>
</html>